OUT_DIR="$ROOT/benchmark_results"

# Benchmark settings
WARMUP_RUNS=5
MEASUREMENT_RUNS=20
ENABLE_PERF=true
ENABLE_HYPERFINE=true
ENABLE_TIME=true
ENABLE_SCHED=true
CLEANUP_TEMP=true

# Python virtual environment setup
SETUP_COMMAND="source .venv/bin/activate"
CLEANUP_COMMAND=""

BENCHMARKS=(
  "dynamic_array_bench:python benchmarks/dynamic_array_bench.py"
  "large_alloc_dealloc_bench:python benchmarks/large_alloc_dealloc_bench.py"
  "large_mem_reuse_bench:python benchmarks/large_mem_reuse_bench.py"
  "linked_list_bench:python benchmarks/linked_list_bench.py"
  "parallel_alloc_bench:python benchmarks/parallel_alloc_bench.py"
  "shared_queue_bench:python benchmarks/shared_queue_bench.py"
  "short_task_bench:python benchmarks/short_task_bench.py"
  "small_alloc_dealloc_bench:python benchmarks/small_alloc_dealloc_bench.py"
  "small_mem_reuse_bench:python benchmarks/small_mem_reuse_bench.py"
)

CUSTOM_BENCHMARK_COMMAND='
  echo "    Running pytest-benchmark for $BENCH_NAME..."
  local pytest_stderr="$BENCH_DIR/pytest_stderr.log"

  if pytest "$ROOT/benchmarks/${BENCH_NAME}.py" \
    --benchmark-only \
    --benchmark-json="$BENCH_DIR/pytest_bench.json" \
    --benchmark-warmup=true \
    --benchmark-warmup-iterations=10 2>"$pytest_stderr"; then
    echo "    pytest-benchmark completed successfully"
  else
    echo "    pytest-benchmark failed"
    if [[ -s "$pytest_stderr" ]]; then
      echo "    Error output:"
      cat "$pytest_stderr"
    fi
  fi
'

ANALYSIS_COMMAND="python3 ../../scripts/benchmark_visualizer.py \$SESSION_DIR"
